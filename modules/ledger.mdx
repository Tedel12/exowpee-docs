## Overview

The Ledger module is the accounting backbone of the Exowpee platform. Its primary purpose is to automatically record all financial transactions (sales, purchases, payments, credits, stock adjustments) as accounting entries, maintain balances, and generate reports for financial tracking, tax compliance, and business insights.

For complete beginners: Imagine every time someone buys something or you buy stock from a supplier, money moves. The Ledger module is like your "account book" that writes down every movement:  
- A sale → money comes in (revenue)  
- A purchase → money goes out (cost)  
- A credit sale → customer owes you (accounts receivable)  
- A payment → reduces what the customer owes  

It does this automatically so you don't have to manually enter numbers in Excel. At the end of the day/month, you can see: "How much money did I make?", "What do I owe suppliers?", "What taxes do I need to pay?".

- **Key Objectives**:
  - Automatically create accounting entries for every business event (orders, purchases, payments).
  - Track debits and credits per account (e.g., cash, bank, sales, cost of goods).
  - Support double-entry bookkeeping (every transaction affects two accounts).
  - Generate reports: sales summary, profit/loss, cash flow, tax reports.
  - Ensure multi-tenant isolation (each company has its own ledger).
  - Integrate with other modules for real-time accounting.

For beginners: You don't need to be an accountant to use this module. The system does most of the work. For example: when you confirm an order (in ORDER module), Ledger automatically creates an entry: "Debit Cash/Bank + Credit Sales Revenue". When you buy stock (in CATALOG), it does "Debit Inventory + Credit Accounts Payable". You just need to look at reports to understand your money flow.

- **How it Fits in Exowpee**:
  - **IAM**: Controls who can view/create entries (permissions like view_ledger, manage_ledger).
  - **ORDER**: Triggers sale entries (revenue) and credit entries.
  - **CATALOG**: Triggers purchase entries (cost) and stock adjustments.
  - **CUSTOMER**: Tracks credit balances (what customers owe).
  - Multi-tenant: All entries are scoped to the current company (from JWT token).

- **Current Status**: The module has a basic structure ready. Endpoints are not fully defined in the current openapi.json. This documentation covers existing/future typical endpoints. You can expand it as you implement.

- **Why It's Important for Developers**:
  - Ledger IDs and entry IDs are Ksuid strings (27 characters).
  - Entries are double-entry (debit and credit must balance).
  - Beginners: Don't worry about Ksuid – generated automatically. Focus on linking events (order_id, purchase_id) to entries.

## Roles & Permissions (RBAC)

The Ledger module uses IAM's RBAC system. Permissions are strict because accounting data is sensitive.

- **Roles** : Typical roles include "Admin/Owner" (full access), "Accountant" (view + create manual entries), "Sales Manager" (view only), "Cashier" (view cash reports).
- **Permissions** : Granular and often restricted.

Common permissions for Ledger:
- `view_ledger` : View entries and reports.
- `view_ledger_reports` : Access financial summaries (sales, profit, cash).
- `create_ledger_entry` : Manually create accounting entries (rare – usually auto).
- `update_ledger_entry` : Edit entries (very restricted – for corrections).
- `delete_ledger_entry` : Delete entries (almost never allowed).
- `manage_accounts` : Create/edit chart of accounts (very advanced).

Example roles:
- **Admin/Owner** : All permissions (view, create, update, delete – though delete is rare).
- **Accountant** : view_ledger, view_ledger_reports, create_ledger_entry (for manual adjustments).
- **Sales Manager** : view_ledger, view_ledger_reports (to see sales performance).
- **Cashier** : view_ledger (limited to cash reports).

For beginners: Accounting data is critical. Most users should have view-only access. Only trusted people (admins/accountants) can create or edit entries. If you get 403 Forbidden, it's likely a missing permission – ask an admin to add it via IAM.

For developers: Permissions are checked server-side. Manual entries should be logged for audit. In multi-tenant, entries are filtered by company_id from token.

## Endpoints

The Ledger module is in early stage, with structure ready but few endpoints defined in openapi.json. Below are typical/future endpoints for a complete accounting system. You can implement them one by one.

| Method | URL | Description | Required Params / Body | Example Response | Required Permissions |
| --- | --- | --- | --- | --- | --- |
| GET | `/v1/ledger/entries` | List accounting entries | `?date_from`, `?type=sale` | `{"data": [{"id": string, "amount": 185000}], "meta": {"total": 50}}` | `view_ledger` |
| GET | `/v1/ledger/entries/{id}` | Get entry details | `id` (Ksuid) | `{"id": string, "amount": 185000, "debit_account": "Cash"}` | `view_ledger` |
| POST | `/v1/ledger/entries` | Create manual entry | `{"type": string, "amount": number, "debit_account": string}` | `{"id": string, "type": "manual", "amount": 50000}` | `create_ledger_entry` |
| GET | `/v1/ledger/reports/sales` | Sales report | `?start_date=2026-01-01` | `{"total_sales": 500000, "tax_collected": 25000}` | `view_ledger_reports` |
| GET | `/v1/ledger/reports/cash_flow` | Cash flow summary | `?period=monthly` | `{"inflows": 600000, "outflows": 400000, "net_cash": 200000}` | `view_ledger_reports` |
| GET | `/v1/ledger/reports/balance_sheet` | Balance sheet | None | `{"assets": {"cash": 300000}, "liabilities": {"payables": 100000}}` | `view_ledger_reports` |

**Note**: Automatic entries are triggered by other modules (e.g., ORDER confirmation creates sale entry). Manual creation is for corrections or special cases.

**Lien vers API Reference** : See [API Reference > Ledger](/api-reference/ledger) for technical details (expand as you implement).

## Examples of Use

Since Ledger is in early stage, examples are based on future/standard endpoints. We’ll explain how it works automatically + manual use.

### Example 1: View Ledger Entries (GET /v1/ledger/entries)

This endpoint lists all accounting entries (automatic + manual). It's useful for seeing what happened financially.

**Required** : Nothing – just the token.

**Optional** :
- ?type=sale : Filter by type (sale, purchase, payment).
- ?date_from=2026-01-01 : Filter date range.
- ?page=2 : Pagination.

cURL example:
```bash
curl -X GET "http://localhost:8000/v1/ledger/entries" \
  -H "Authorization: Bearer <your_token>"
```

**Expected Response (200 OK)** :
```json
{
  "data": [
    {
      "id": "39WSvi21oTnZN8i028Y80FTNT1x",
      "type": "sale",
      "amount": 185000,
      "debit_account": "Cash",
      "credit_account": "Sales Revenue",
      "description": "Sale of Samsung Galaxy A54",
      "reference_id": "order_id_here",
      "created_at": "2026-02-12T17:00:00Z"
    },
    {
      "id": "39XabcdeFgHijKlMnOpQrStUvWx",
      "type": "purchase",
      "amount": 150000,
      "debit_account": "Inventory",
      "credit_account": "Accounts Payable",
      "description": "Purchase from Samsung Supplier",
      "reference_id": "purchase_id_here",
      "created_at": "2026-02-12T16:30:00Z"
    }
  ],
  "meta": {
    "current_page": 1,
    "last_page": 1,
    "per_page": 15,
    "total": 2
  }
}
```

**Explanation of Response Properties** :
- **data** : Array of entry objects. Each entry has:
  - **id** : Unique Ksuid for the entry.
  - **type** : What caused the entry (sale, purchase, payment, adjustment).
  - **amount** : Money amount (positive).
  - **debit_account** : Account increased (e.g., Cash for sales, Inventory for purchases).
  - **credit_account** : Account decreased (e.g., Sales Revenue, Accounts Payable).
  - **description** : Human-readable explanation.
  - **reference_id** : Link to source (order_id, purchase_id).
  - **created_at** : When the entry was created.
- **meta** : Pagination info.

**What This Does** : Fetches entries from the database, scoped to your company, applies filters, and returns paginated list.

**Beginner Tips** :
- Use ?type=sale to see all sales revenue.
- Test in Postman: GET request, add query params.
- Common error: 403 – need "view_ledger". Empty data? No transactions yet.

**Advanced Notes** : Entries are immutable (no update/delete in most cases). Use adjustments for corrections.

### Example 2: View Sales Report (GET /v1/ledger/reports/sales)

This endpoint gives a summary of sales (revenue, tax, profit) – very useful for daily/monthly tracking.

**Required** : Nothing.

**Optional** :
- ?start_date=2026-01-01
- ?end_date=2026-02-12

cURL example:
```bash
curl -X GET "http://localhost:8000/v1/ledger/reports/sales?start_date=2026-02-01&end_date=2026-02-12" \
  -H "Authorization: Bearer <your_token>"
```

**Expected Response (200 OK)** :
```json
{
  "total_sales": 750000,
  "tax_collected": 37500,
  "discounts_given": 15000,
  "net_revenue": 712500,
  "cost_of_goods": 450000,
  "gross_profit": 262500,
  "period": "2026-02-01 to 2026-02-12"
}
```

**Explanation of Response Properties** :
- **total_sales** : Total money from sales before tax/discount.
- **tax_collected** : Tax amount collected.
- **discounts_given** : Discounts applied.
- **net_revenue** : Sales after tax/discount.
- **cost_of_goods** : Cost of products sold.
- **gross_profit** : Profit before expenses (net_revenue - cost_of_goods).
- **period** : Date range used.

**What This Does** : Aggregates order data from ORDER module, calculates totals, and returns summary.

**Beginner Tips** :
- Use this daily to see how much you sold.
- Test in Postman: GET with date params.
- Common error: 403 – need "view_ledger_reports".

**Advanced Notes** : Can be extended for per-product sales, per-customer.

### Example 3: Manual Entry (POST /v1/ledger/entries) – Advanced / Future

This is for manual adjustments (rare, for accountants).

**Required** :
- type, amount, debit_account, credit_account, description.

cURL example:
```bash
curl -X POST "http://localhost:8000/v1/ledger/entries" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your_token>" \
  -d '{
    "type": "adjustment",
    "amount": 5000,
    "debit_account": "Cash",
    "credit_account": "Miscellaneous Expense",
    "description": "Cash expense for office supplies",
    "reference_id": "receipt_123"
  }'
```

**Expected Response (201 Created)** :
```json
{
  "id": "39LedgerEntryKsuidHere",
  "type": "adjustment",
  "amount": 5000,
  "debit_account": "Cash",
  "credit_account": "Miscellaneous Expense",
  "description": "Cash expense for office supplies",
  "reference_id": "receipt_123",
  "created_at": "2026-02-12T17:30:00Z"
}
```

**Explanation** : Creates a manual double-entry.

**Beginner Tips** : Avoid manual entries unless you know accounting. Use automatic ones from other modules.

**Common error** : 403 – need "create_ledger_entry".

### Example 4: Balance Sheet Report (GET /v1/ledger/reports/balance_sheet)

Shows assets, liabilities, equity at a point in time.

cURL example:
```bash
curl -X GET "http://localhost:8000/v1/ledger/reports/balance_sheet" \
  -H "Authorization: Bearer <your_token>"
```

**Expected Response** :
```json
{
  "assets": {
    "cash": 300000,
    "inventory": 450000,
    "accounts_receivable": 120000,
    "total_assets": 870000
  },
  "liabilities": {
    "accounts_payable": 200000,
    "total_liabilities": 200000
  },
  "equity": 670000,
  "as_of": "2026-02-12"
}
```

**Explanation** : Snapshot of financial position.

**Beginner Tips** : Use monthly for business health check.

## Was this page helpful?

Your feedback helps us improve the documentation.

<div style={{ display: 'flex', gap: '16px', marginTop: '16px' }}>
  <button
    onClick={() => {
      document.getElementById('feedback-yes-message').style.display = 'block';
      document.getElementById('feedback-no-message').style.display = 'none';
      setTimeout(() => {
        document.getElementById('feedback-yes-message').style.display = 'none';
      }, 4000);
    }}
    style={{
      padding: '10px 24px',
      color: '#16A34A',
      border: 'none',
      borderRadius: '8px',
      cursor: 'pointer',
      fontWeight: '600',
      fontSize: '15px',
    }}
  >
    Yes
  </button>

  <button
    onClick={() => {
      document.getElementById('feedback-no-message').style.display = 'block';
      document.getElementById('feedback-yes-message').style.display = 'none';
      setTimeout(() => {
        document.getElementById('feedback-no-message').style.display = 'none';
      }, 4000);
    }}
    style={{
      padding: '10px 24px',
      color: '#e53e3e',
      border: 'none',
      borderRadius: '8px',
      cursor: 'pointer',
      fontWeight: '600',
      fontSize: '15px',
    }}
  >
    No
  </button>
</div>

{/* Message Yes */}
<div 
  id="feedback-yes-message" 
  style={{ 
    display: 'none', 
    marginTop: '20px', 
    padding: '12px 20px', 
    backgroundColor: '#000702d6', 
    borderRadius: '8px', 
    border: 'none', 
    color: '#16A34A', 
    fontSize: '15px', 
    fontWeight: '500',
    textAlign: 'center'
  }}
>
  Thank you! We're glad this helped
</div>

{/* Message No */}
<div 
  id="feedback-no-message" 
  style={{ 
    display: 'none', 
    marginTop: '20px', 
    padding: '12px 20px', 
    backgroundColor: '#130101', 
    borderRadius: '8px', 
    border: 'none', 
    color: '#991b1b', 
    fontSize: '15px', 
    fontWeight: '500',
    textAlign: 'center'
  }}
>
  Thanks for the feedback — we'll improve it!
</div>
```