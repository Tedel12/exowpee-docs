
## Overview

The IAM module (Identity & Access Management) is the core system for handling user identities, authentication, and access control in the Exowpee platform. Its primary purpose is to ensure secure user login, registration, role-based access control (RBAC), and permission management across multi-tenant companies. This module provides the foundation for all other modules, as it handles authentication tokens and user contexts.

- **Key Objectives**:
  - Allow users to register and log in securely.
  - Manage roles (e.g., admin, manager) and granular permissions (e.g., "create_product").
  - Support multi-account users (one user can have profiles in multiple companies).
  - Generate JWT tokens with automatic refresh for session management.
  - Enforce multi-tenant security, where data is isolated per company.


## Endpoints

IAM has 8 routes for auth, roles, profiles, and user_profiles. Below is a table with details. All protected endpoints require Bearer JWT token in the header.

For more technical details, see the [API Reference > Authentication](/api-reference).

## Examples of Use

Let's walk through using the IAM module step by step, as if you're a new developer setting up your first account. We'll use cURL examples, but you can use Postman or any HTTP client. Assume you're working on local (http://localhost:8000).

### Example : Connection and Obtaining Token (Login)

This endpoint is the starting point for all authenticated actions. It verifies your email and password, and returns a JWT token that you must use in the "Authorization" header for other requests. The token is like a temporary key to the app – it expires after a time (default 1 hour), so you'll need to refresh or login again if it expires.

**Required** :
- email: Your registered email (must be unique in the system).
- password: Your password (stored hashed for security).

cURL example:
```bash
curl -X POST "http://localhost:8000/v1/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "ben@example.com",
    "password": "password123"
  }'
```

**Expected Response (200 OK)** :
```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwMDAvdjEvYXV0aC9zd2l0Y2gtdXNlci1wcm9maWxlIiwiaWF0IjoxNzcwODE3MDYxLCJleHAiOjE3NzA4MjA2NjEsIm5iZiI6MTc3MDgxNzA2MSwianRpIjoiYm9LZjRjRXlkOFRTaFJROCIsInN1YiI6IjM5V1N2Zkk4UzJ2RW9za3J5bGthY25MVnlYZCIsInBydiI6ImNkMDk3MWMzZGI2MGE5ZWJhYjkwZjFiZTg2YjNhYTc5Y2U5MDk0YzEiLCJ1c2VyX2lkIjoiMzlXU3ZmSThTMnZFb3Nrcnlsa2FjbkxWeVhkIiwidHlwZSI6InVzZXIiLCJjdXJyZW50X3VzZXJfcHJvZmlsZV9pZCI6IjM5V1N2aWRvNkI1ZUNzQzlDQnNlVzNxRDlKaiIsImNvbXBhbnlfaWQiOiIzOVdTdmkyMW9UblpOOGkwMjhZODBGVE5UMXgiLCJwcm9maWxlX2lkIjoiMzlXU3ZsM3FpMll4NEN4Y0p3YzJWYTBlNUZwIiwib3JnYW5pemF0aW9uX2lkIjoiMzlXU3ZkdHRidlFBbzBNalZxcUZCSFFpSmh6In0.wvZ86CIj6TL12OzrBOmlwuWWHEiyVFaOJi_2waXzTC4",
  "token_type": "bearer",
  "expires_in": 3600
}
```

**Explanation of Response Properties** :
- **access_token**: This is the JWT token string you must use in the "Authorization" header for protected endpoints. It encodes your user ID, company ID, and permissions. Example: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...". Copy this value and prefix it with "Bearer " in future requests (e.g., "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...").
- **token_type**: Always "bearer". This tells you how to use the token (as a Bearer token in headers).
- **expires_in**: Number of seconds until the token expires (e.g., 3600 seconds = 1 hour). After this, you need to login again or use a refresh mechanism (see advanced notes below).

**What This Does** : 
  - The server checks your email and password against the database. If correct, it generates a signed JWT token containing your user details and returns it. This token is used to authenticate all subsequent requests. If the credentials are invalid, you'll get a 400 error with "Invalid credentials".
  - The token includes multi-tenant info like company_id and organization_id. For refresh, the module supports automatic refresh (not shown in openapi.json; check Laravel code for implementation). Use this token in all other endpoints' headers.
  - This enables multi-tenant switching without logout. Token is updated with new company_id.

**Link to API Reference** : See [API Reference > iam](/api-reference) for technical details.

## Notes for Developers

- **JWT Tokens** : Tokens include user_id, company_id, profile_id, organization_id. Refresh is automatic (check code for implementation).
- **Multi-tenant** : All data is scoped to company_id from the token.
- **Security** : Use HTTPS, validate permissions server-side.
- **Troubleshooting** : 401 → invalid token; 403 → missing permission; 400 → invalid input.
- **Extensions** : Integrate with email verification or password reset (not in current openapi).

## Was this page helpful?

Your feedback helps us improve the documentation.



<div style={{ display: 'flex', gap: '16px', marginTop: '16px' }}>
  <button
    onClick={() => {
      document.getElementById('feedback-yes-message').style.display = 'block';
      document.getElementById('feedback-no-message').style.display = 'none';
      setTimeout(() => {
        document.getElementById('feedback-yes-message').style.display = 'none';
      }, 4000);
    }}
    style={{
      padding: '10px 24px',
      color: '#16A34A',
      border: 'none',
      borderRadius: '8px',
      cursor: 'pointer',
      fontWeight: '600',
      fontSize: '15px',
    }}
  >
    Yes
  </button>

  <button
    onClick={() => {
      document.getElementById('feedback-no-message').style.display = 'block';
      document.getElementById('feedback-yes-message').style.display = 'none';
      setTimeout(() => {
        document.getElementById('feedback-no-message').style.display = 'none';
      }, 4000);
    }}
    style={{
      padding: '10px 24px',
      color: '#e53e3e',
      border: 'none',
      borderRadius: '8px',
      cursor: 'pointer',
      fontWeight: '600',
      fontSize: '15px',
    }}
  >
    No
  </button>
</div>

{/* Message Yes */}
<div 
  id="feedback-yes-message" 
  style={{ 
    display: 'none', 
    marginTop: '20px', 
    padding: '12px 20px', 
    backgroundColor: '#000702d6', 
    borderRadius: '8px', 
    border: 'none', 
    color: '#16A34A', 
    fontSize: '15px', 
    fontWeight: '500',
    textAlign: 'center'
  }}
>
  Thank you! We're glad this helped
</div>

{/* Message No */}
<div 
  id="feedback-no-message" 
  style={{ 
    display: 'none', 
    marginTop: '20px', 
    padding: '12px 20px', 
    backgroundColor: '#130101', 
    borderRadius: '8px', 
    border: 'none', 
    color: '#991b1b', 
    fontSize: '15px', 
    fontWeight: '500',
    textAlign: 'center'
  }}
>
  Thanks for the feedback — we'll improve it!
</div>

```